(this.webpackJsonpp2wiki=this.webpackJsonpp2wiki||[]).push([[0],{200:function(e,t,n){e.exports=n(436)},205:function(e,t,n){},206:function(e,t,n){},238:function(e,t){},240:function(e,t){},250:function(e,t){},252:function(e,t){},257:function(e,t){},258:function(e,t){},268:function(e,t){},270:function(e,t){},278:function(e,t){},280:function(e,t){},290:function(e,t){},292:function(e,t){},299:function(e,t){},301:function(e,t){},308:function(e,t){},309:function(e,t){},311:function(e,t){},313:function(e,t){},315:function(e,t){},330:function(e,t){},335:function(e,t){},337:function(e,t){},346:function(e,t){},348:function(e,t){},349:function(e,t){},352:function(e,t){},353:function(e,t){},356:function(e,t){},362:function(e,t){},365:function(e,t){},367:function(e,t){},379:function(e,t){},381:function(e,t){},394:function(e,t){},396:function(e,t){},410:function(e,t){},412:function(e,t){},425:function(e,t){},427:function(e,t){},434:function(e,t){},435:function(e,t,n){},436:function(e,t,n){"use strict";n.r(t);var i=n(5),a=n.n(i),r=n(197),o=n.n(r),c=(n(205),n(206),n(45)),s=n(46),l=n(57),u=n(56),h=n(198),f=n(15),m=n(79),d=n(58),p=n.n(d),y=n(199),g=n.n(y),v=n(263),x=n(108)("p2wiki"),w=function(){function e(t){Object(c.a)(this,e),this.proxyPeers={},this.proxyPeersID=[],this.curProxyPeerIndex=0,this.announceURLs=t,this.wt=new v,this.p2pt=new g.a(t,"p2wiki")}return Object(s.a)(e,[{key:"startProxy",value:function(){var e=this;this.p2pt.on("msg",(function(t,n){if("c"===n)t.respond("p").catch((function(e){console.error("Connection to client failed before handsahake. "+e)}));else try{n=JSON.parse(n),console.log("Got request for article "+n.articleName),e.makeArticleTorrent(n.articleName).then((function(e){t.respond(e.infoHash)}))}catch(i){console.log(i)}})),this.p2pt.start()}},{key:"startClient",value:function(){var e=this,t=this;this.p2pt.on("peerconnect",(function(e){t.p2pt.send(e,"c").then((function(e){var n=Object(m.a)(e,2),i=n[0];"p"===n[1]&&(t.proxyPeers[i.id]=i,t.proxyPeersID.push(i.id))}))})),this.p2pt.on("peerclose",(function(n){delete t.proxyPeers[n],delete t.proxyPeersID[e.proxyPeersID.indexOf(n)]})),this.p2pt.start()}},{key:"getAProxyPeer",value:function(){return 0!==this.proxyPeersID.length&&(this.curProxyPeerIndex>this.proxyPeersID.length-1&&(this.curProxyPeerIndex=0),this.proxyPeers[this.proxyPeersID[this.curProxyPeerIndex]])}},{key:"makeArticleTorrent",value:function(e){var t=this;return new Promise((function(n,i){var a=[],r={title:"",article:!1,media:[],mediaCount:0};e=encodeURIComponent(e);var o=function(){r.article&&r.media.length===r.mediaCount&&t.wt.seed(a,{announceList:[t.announceURLs],name:r.title},(function(e){n(e)}))};p.a.get("//en.wikipedia.org/w/api.php?action=parse&format=json&page=".concat(e,"&prop=text&formatversion=2&origin=*")).then((function(t){var n=new window.File([t.data.parse.text],"article.html",{type:"text/html"});a.push(n),r.title=t.data.parse.title,r.article=!0,x("Article ".concat(e," : Fetched text")),o()})).catch((function(e){i(e)}));var c=function(t,n,c){p()({method:"get",url:c,responseType:"blob"}).then((function(n){var i=t,c=new window.File([n.data],i);a.push(c),r.media.push(i),x("Article ".concat(e," : Fetched image ").concat(r.media.length,"/").concat(r.mediaCount)),o()})).catch((function(e){i(e)}))};p.a.get("//en.wikipedia.org/api/rest_v1/page/media-list/".concat(e)).then((function(t){var n;for(var i in t.data.items)(n=t.data.items[i]).srcset&&(c(n.title,n.srcset[0].scale,n.srcset[0].src),r.mediaCount++);x("Article ".concat(e," : Fetched medialist. Has ").concat(r.mediaCount," images"))})).catch((function(e){i(e)}))}))}},{key:"requestArticle",value:function(e,t,n){this.p2pt.requestMorePeers();var i=this.getAProxyPeer();if(!i)return!1;var a=this;this.p2pt.send(i,JSON.stringify({articleName:e})).then((function(e){var n=Object(m.a)(e,2),i=(n[0],n[1]);a.wt.add(i,{announce:a.announceURLs},(function(e){var n={title:"",text:null,media:{}};e.files.forEach((function(t){"article.html"===t.name?(n.title=e.name,n.text=t):n.media[t.name]=t})),t(n)}))}))}}]),e}(),b=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;Object(c.a)(this,n),(i=t.call(this,e)).handleChange=i.handleChange.bind(Object(f.a)(i)),i.handleSubmit=i.handleSubmit.bind(Object(f.a)(i)),i.getFromWiki=i.getFromWiki.bind(Object(f.a)(i)),i.state={title:"",query:"",result:"",beAProxy:!1},i.media={},i.retryInterval=null;var a=["wss://tracker.openwebtorrent.com","wss://tracker.sloppyta.co:443/announce","wss://tracker.novage.com.ua:443/announce","wss://tracker.btorrent.xyz:443/announce"];"localhost"===window.location.hostname&&(a=["ws://localhost:5000"]),i.p2wiki=new w(a),"true"===window.localStorage.getItem("beAProxy")?(i.state.beAProxy=!0,i.p2wiki.startProxy()):i.p2wiki.startClient();var r=Object(f.a)(i),o=document.location.pathname.split("/");return o.length>2&&"wiki"===o[o.length-2]&&setTimeout((function(){r.urloli(o[o.length-1]),r.getFromWiki()}),1e3),i}return Object(s.a)(n,[{key:"getFromWiki",value:function(){if(""!==this.state.query){var e=this;!1===this.p2wiki.requestArticle(this.state.query,(function(t){e.media=t.media,t.text.getBuffer((function(n,i){e.setState({title:t.title,result:i.toString()}),n&&console.log(n)}))}))&&(console.log("nopeer, retrying in 3 seconds"),clearInterval(this.retryInterval),this.retryInterval=setTimeout(this.getFromWiki,3e3))}}},{key:"handleSubmit",value:function(e){e.preventDefault(),console.log(this.state.query),this.getFromWiki()}},{key:"handleChange",value:function(e){var t="checkbox"===e.target.type?e.target.checked:e.target.value;this.setState(Object(h.a)({},e.target.name,t)),"beAProxy"===e.target.name&&(window.localStorage.setItem("beAProxy",t),window.location.reload())}},{key:"urloli",value:function(e){this.setState({query:e})}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement("label",{className:"checkbox"},a.a.createElement("input",{type:"checkbox",onChange:this.handleChange,name:"beAProxy",checked:this.state.beAProxy}),a.a.createElement("span",{style:{marginLeft:"5px"}},"Be a Proxy Peer")),a.a.createElement("div",{className:"field"},a.a.createElement("div",{className:"control"},a.a.createElement("input",{className:"input is-rounded",id:"query",type:"Text",placeholder:"\ud83d\udd0d Search for an article",onChange:this.handleChange,name:"query",value:this.state.query})))),a.a.createElement("div",{className:"container mx-auto"},a.a.createElement("h1",{className:"title text-4xl"},this.state.title),a.a.createElement("div",{dangerouslySetInnerHTML:function(t){for(var n,i=(t=(new window.DOMParser).parseFromString(t,"text/html")).querySelectorAll("a[class='image']"),a=0;a<i.length;a++)n=new URL(i[a].href).pathname.slice(6),i[a].firstChild.src="",e.media[n]&&e.media[n].renderTo(i[a].firstChild);return{__html:t.body.innerHTML}}(this.state.result)})))}}]),n}(a.a.Component),k=(n(435),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{textAlign:"center"}},a.a.createElement("h1",{style:{color:"royalblue",fontSize:"50px"}},"P2Wiki"),a.a.createElement(b,null)),a.a.createElement("footer",{className:"footer"},a.a.createElement("div",{style:{textAlign:"center"}},a.a.createElement("p",{style:{color:"hotpink"}},"P2Wiki made by Subin Siby, Pranav Shridhar and Athul Cyriac Ajay"))))}}]),n}(i.Component));var P=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(k,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(P,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[200,1,2]]]);
//# sourceMappingURL=main.e86f0eb4.chunk.js.map