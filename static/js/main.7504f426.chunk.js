(this.webpackJsonpp2wiki=this.webpackJsonpp2wiki||[]).push([[0],{105:function(e,t){},107:function(e,t){},114:function(e,t,n){},115:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(43),i=n.n(o),c=(n(52),n(53),n(7)),s=n(8),l=n(18),u=n(17),h=n(44),p=n(4),m=n(22),y=n(45),d=n.n(y),f=n(46),g=n.n(f),x=function(){function e(t){Object(c.a)(this,e),this.proxyPeers={},this.proxyPeersID=[],this.curProxyPeerIndex=0,this.p2pt=new g.a(t,"p2wiki")}return Object(s.a)(e,[{key:"startProxy",value:function(){this.p2pt.on("msg",(function(e,t){if("c"===t)e.respond("p").catch((function(e){console.error("Connection to client failed before handsahake. "+e)}));else try{t=JSON.parse(t),console.log("Got request for article "+t.articleName),d.a.get("//en.wikipedia.org/w/api.php?action=parse&format=json&page=".concat(t.articleName,"&prop=text&formatversion=2&origin=*")).then((function(t){console.log(t),e.respond(JSON.stringify(t))})).catch((function(e){console.log(e)}))}catch(n){console.log(n)}})),this.p2pt.start()}},{key:"startClient",value:function(){var e=this,t=this;this.p2pt.on("peerconnect",(function(e){t.p2pt.send(e,"c").then((function(e){var n=Object(m.a)(e,2),a=n[0];"p"===n[1]&&(t.proxyPeers[a.id]=a,t.proxyPeersID.push(a.id))}))})),this.p2pt.on("peerclose",(function(n){delete t.proxyPeers[n],delete t.proxyPeersID[e.proxyPeersID.indexOf(n)]})),this.p2pt.start()}},{key:"getAProxyPeer",value:function(){return 0!==this.proxyPeersID.length&&(this.curProxyPeerIndex>this.proxyPeersID.length-1&&(this.curProxyPeerIndex=0),this.proxyPeers[this.proxyPeersID[this.curProxyPeerIndex]])}},{key:"requestArticle",value:function(e,t,n){this.p2pt.requestMorePeers();var a=this.getAProxyPeer();if(!a)return!1;this.p2pt.send(a,JSON.stringify({articleName:e})).then((function(e){var n=Object(m.a)(e,2),a=(n[0],n[1]);try{t(JSON.parse(a))}catch(r){console.log(r)}}))}}]),e}(),v=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;Object(c.a)(this,n),(a=t.call(this,e)).handleChange=a.handleChange.bind(Object(p.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(p.a)(a)),a.getFromWiki=a.getFromWiki.bind(Object(p.a)(a)),a.state={title:"",query:"",result:"",beAProxy:!1},a.retryInterval=null;var r=["wss://tracker.openwebtorrent.com","wss://tracker.sloppyta.co:443/announce","wss://tracker.novage.com.ua:443/announce","wss://tracker.btorrent.xyz:443/announce"];"localhost"===window.location.hostname&&(r=["ws://localhost:5000"]),a.p2wiki=new x(r),"true"===window.localStorage.getItem("beAProxy")?(a.state.beAProxy=!0,a.p2wiki.startProxy()):a.p2wiki.startClient();var o=Object(p.a)(a),i=document.location.pathname.split("/");return i.length>2&&"wiki"===i[i.length-2]&&setTimeout((function(){o.urloli(i[i.length-1]),o.getFromWiki()}),1e3),a}return Object(s.a)(n,[{key:"getFromWiki",value:function(){if(""!==this.state.query){var e=this;!1===this.p2wiki.requestArticle(this.state.query,(function(t){e.setState({title:t.data.parse.title,result:t.data.parse.text})}))&&(console.log("nopeer, retrying in 3 seconds"),clearInterval(this.retryInterval),this.retryInterval=setTimeout(this.getFromWiki,3e3))}}},{key:"handleSubmit",value:function(e){e.preventDefault(),console.log(this.state.query),this.getFromWiki()}},{key:"handleChange",value:function(e){var t="checkbox"===e.target.type?e.target.checked:e.target.value;this.setState(Object(h.a)({},e.target.name,t)),"beAProxy"===e.target.name&&(window.localStorage.setItem("beAProxy",t),window.location.reload())}},{key:"urloli",value:function(e){this.setState({query:e})}},{key:"render",value:function(){var e;return r.a.createElement("div",null,r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{type:"checkbox",onChange:this.handleChange,name:"beAProxy",checked:this.state.beAProxy}),r.a.createElement("span",{style:{marginLeft:"5px"}},"Be a Proxy Peer")),r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input is-rounded",id:"query",type:"Text",placeholder:"\ud83d\udd0d Search for an article",onChange:this.handleChange,name:"query",value:this.state.query})))),r.a.createElement("div",{className:"container mx-auto"},r.a.createElement("h1",{className:"title text-4xl"},this.state.title),r.a.createElement("div",{dangerouslySetInnerHTML:(e=this.state.result,{__html:e})})))}}]),n}(r.a.Component),b=(n(114),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("h1",{style:{color:"royalblue",fontSize:"50px"}},"P2Wiki"),r.a.createElement(v,null)),r.a.createElement("footer",{className:"footer"},r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("p",{style:{color:"hotpink"}},"P2Wiki made by Subin Siby, Pranav Shridhar and Athul Cyriac Ajay"))))}}]),n}(a.Component));var k=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(b,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},47:function(e,t,n){e.exports=n(115)},52:function(e,t,n){},53:function(e,t,n){},92:function(e,t){},94:function(e,t){}},[[47,1,2]]]);
//# sourceMappingURL=main.7504f426.chunk.js.map