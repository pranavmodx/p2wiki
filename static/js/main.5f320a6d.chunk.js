(this.webpackJsonpp2wiki=this.webpackJsonpp2wiki||[]).push([[0],{105:function(e,t){},107:function(e,t){},114:function(e,t,n){},115:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(43),o=n.n(i),s=(n(52),n(53),n(4)),c=n(5),l=n(10),u=n(9),h=n(44),d=n(6),p=n(22),f=n(45),m=n.n(f),y=n(46),g=function(){function e(t){Object(s.a)(this,e),this.proxyPeers={},this.proxyPeersID=[],this.curProxyPeerIndex=0,this.p2pt=new y.a(t,"p2wiki")}return Object(c.a)(e,[{key:"startProxy",value:function(){this.p2pt.on("msg",(function(e,t){if("c"===t)e.respond("p").catch((function(e){console.error("Connection to client failed before handsahake"+e)}));else try{t=JSON.parse(t),m.a.get("//en.wikipedia.org/w/api.php?action=parse&format=json&page=".concat(t.articleName,"&prop=text&formatversion=2&origin=*")).then((function(t){console.log(t),e.respond(JSON.stringify(t))})).catch((function(e){console.log(e)}))}catch(n){console.log(n)}})),this.p2pt.start()}},{key:"startClient",value:function(){var e=this,t=this;this.p2pt.on("peerconnect",(function(e){t.p2pt.send(e,"c").then((function(e){var n=Object(p.a)(e,2),r=n[0];"p"===n[1]&&(t.proxyPeers[r.id]=r,t.proxyPeersID.push(r.id))}))})),this.p2pt.on("peerclose",(function(n){delete t.proxyPeers[n],delete t.proxyPeersID[e.proxyPeersID.indexOf(n)]})),this.p2pt.start()}},{key:"getAProxyPeer",value:function(){return 0!==this.proxyPeersID.length&&(this.curProxyPeerIndex>this.proxyPeersID.length-1&&(this.curProxyPeerIndex=0),this.proxyPeers[this.proxyPeersID[this.curProxyPeerIndex]])}},{key:"requestArticle",value:function(e,t,n){this.p2pt.search();var r=this.getAProxyPeer();if(!r)return!1;this.p2pt.send(r,JSON.stringify({articleName:e})).then((function(e){var n=Object(p.a)(e,2),r=(n[0],n[1]);try{t(JSON.parse(r))}catch(a){console.log(a)}}))}}]),e}(),v=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var r;Object(s.a)(this,n),(r=t.call(this,e)).handleChange=r.handleChange.bind(Object(d.a)(r)),r.handleSubmit=r.handleSubmit.bind(Object(d.a)(r)),r.getFromWiki=r.getFromWiki.bind(Object(d.a)(r)),r.state={title:"",query:"",result:"",beAProxy:!1},r.retryInterval=null;var a=["ws://localhost:5000","wss://tracker.openwebtorrent.com","wss://tracker.sloppyta.co:443/announce","wss://tracker.novage.com.ua:443/announce"];"localhost"===window.location.hostname&&(a=["ws://localhost:5000"]),r.p2wiki=new g(a),"true"===localStorage.getItem("beAProxy")?(r.state.beAProxy=!0,r.p2wiki.startProxy()):r.p2wiki.startClient();var i=Object(d.a)(r),o=document.location.pathname.split("/");return o.length>2&&"wiki"===o[o.length-2]&&setTimeout((function(){i.urloli(o[o.length-1]),i.getFromWiki()}),1e3),r}return Object(c.a)(n,[{key:"getFromWiki",value:function(){if(""!==this.state.query){var e=this;!1===this.p2wiki.requestArticle(this.state.query,(function(t){e.setState({title:t.data.parse.title,result:t.data.parse.text})}))&&(console.log("nopeer, retrying in 3 seconds"),clearInterval(this.retryInterval),this.retryInterval=setTimeout(this.getFromWiki,3e3))}}},{key:"handleSubmit",value:function(e){e.preventDefault(),console.log(this.state.query),this.getFromWiki()}},{key:"handleChange",value:function(e){var t="checkbox"===e.target.type?e.target.checked:e.target.value;this.setState(Object(h.a)({},e.target.name,t)),"beAProxy"===e.target.name&&(localStorage.setItem("beAProxy",t),window.location.reload())}},{key:"urloli",value:function(e){this.setState({query:e})}},{key:"render",value:function(){var e;return a.a.createElement("div",null,a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement("label",{className:"checkbox"},a.a.createElement("input",{type:"checkbox",onChange:this.handleChange,name:"beAProxy",checked:this.state.beAProxy}),a.a.createElement("span",{style:{marginLeft:"5px"}},"Be a Proxy Peer")),a.a.createElement("div",{className:"field"},a.a.createElement("div",{className:"control"},a.a.createElement("input",{className:"input is-rounded",id:"query",type:"Text",placeholder:"\ud83d\udd0d Search for an article",onChange:this.handleChange,name:"query",value:this.state.query})))),a.a.createElement("div",{className:"container mx-auto"},a.a.createElement("h1",{className:"title text-4xl"},this.state.title),a.a.createElement("div",{dangerouslySetInnerHTML:(e=this.state.result,{__html:e})})))}}]),n}(a.a.Component),k=(n(114),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{textAlign:"center"}},a.a.createElement("h1",{style:{color:"royalblue",fontSize:"50px"}},"P2Wiki"),a.a.createElement(v,null)),a.a.createElement("footer",{className:"footer"},a.a.createElement("div",{style:{textAlign:"center"}},a.a.createElement("p",{style:{color:"hotpink"}},"P2Wiki made by Subin Siby, Pranav Shridhar and Athul Cyriac Ajay"))))}}]),n}(r.Component));var b=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(k,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(b,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},46:function(e,t,n){"use strict";(function(e){var r=n(4),a=n(5),i=n(10),o=n(9),s=n(73),c=n(17),l=n(18),u=n(109),h=n(111)("p2pt"),d=function(t){Object(i.a)(l,t);var n=Object(o.a)(l);function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(r.a)(this,l),(e=n.call(this)).announceURLs=t,e.peers={},e.msgChunks={},a&&e.setIdentifier(a),e._peerIdBuffer=c(20),e._peerId=e._peerIdBuffer.toString("hex"),e._peerIdBinary=e._peerIdBuffer.toString("binary"),e}return Object(a.a)(l,[{key:"setIdentifier",value:function(t){this.identifierString=t,this.infoHash=u.sync(t).toLowerCase(),this._infoHashBuffer=e.from(this.infoHash,"hex"),this._infoHashBinary=this._infoHashBuffer.toString("binary")}},{key:"start",value:function(){var e=this;this.on("peer",(function(t){t.on("connect",(function(){e.emit("peerconnect",t)})),t.on("data",(function(n){if(e.emit("data",t,n),n=n.toString(),h("got a message : "+n),"p"===n[0])try{n=JSON.parse(n.slice(1)),t.respond=e._peerRespond(t,n.id);var r=e._chunkHandler(n);!1!==r&&e.emit("msg",t,r)}catch(a){console.log(a)}})),t.on("error",(function(n){e.removePeer(t.id),h("Error in connection : "+n)})),t.on("close",(function(){e.removePeer(t.id),h("Conncection closed")}))})),this._fetchPeers()}},{key:"removePeer",value:function(e){this.emit("peerclose",e),delete this.peers[e]}},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=this;return new Promise((function(a,i){e.connected||i(Error("closed"));var o={id:""!==n?n:Math.floor(1e5*Math.random()+1e5),msg:t};e.on("data",(function t(n){if("p"===(n=n.toString())[0])try{if((n=JSON.parse(n.slice(1))).id===o.id){var i=r._chunkHandler(n);!1!==i&&(e.removeListener("data",t),r._destroyChunks(o.id),a([e,i]))}}catch(s){console.log(s)}}));for(var s=0,c="";o.msg.length>0;)o.c=s,c=o.msg.slice(16e3),o.msg=o.msg.slice(0,16e3),c||(o.last=!0),e.send("p"+JSON.stringify(o)),o.msg=c,s++}))}},{key:"search",value:function(){var e=this,t=this;return new Promise((function(n){e._fetchPeers(),n(t.peers)}))}},{key:"_peerRespond",value:function(e,t){var n=this;return function(r){return n.send(e,r,t)}}},{key:"_chunkHandler",value:function(e){return this.msgChunks[e.id]||(this.msgChunks[e.id]=[]),this.msgChunks[e.id][e.c]=e.msg,!!e.last&&this.msgChunks[e.id].join("")}},{key:"_destroyChunks",value:function(e){delete this.msgChunks[e]}},{key:"_defaultAnnounceOpts",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null==e.numwant&&(e.numwant=50),null==e.uploaded&&(e.uploaded=0),null==e.downloaded&&(e.downloaded=0),e}},{key:"_fetchPeers",value:function(){for(var e in this.announceURLs)new s(this,this.announceURLs[e]).announce({numwant:50})}}]),l}(l);t.a=d}).call(this,n(3).Buffer)},47:function(e,t,n){e.exports=n(115)},52:function(e,t,n){},53:function(e,t,n){},92:function(e,t){},94:function(e,t){}},[[47,1,2]]]);
//# sourceMappingURL=main.5f320a6d.chunk.js.map